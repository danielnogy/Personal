@using BinaryPlate.BlazorPlate.Contracts.Consumers.SSM
@using BinaryPlate.BlazorPlate.Features.SSM.MaterialCategories.Queries.GetMaterialCategoriess
@using BinaryPlate.BlazorPlate.Features.SSM.Materials.Commands.UpdateMaterial
@using BinaryPlate.BlazorPlate.Features.SSM.Materials.Queries.GetMaterialForEdit
@using BinaryPlate.BlazorPlate.Features.SSM.Materials.Queries.GetMaterials

@using Syncfusion.Blazor.Popups



<EditForm Model="MaterialModel" OnValidSubmit="OnValidSubmit">
    <EditContextApiExceptionFallback @ref="EditContextApiExceptionFallback" />
    <FluentValidationValidator />

    <SfCard>
        <CardHeader>
            <MudText Typo="Typo.h5" Color="Color.Primary" Class="mb-4">
                @HeaderText
            </MudText>
        </CardHeader>
        <CardContent>
            <SfTab CssClass="default-tab e-background">
                <TabItems>
                    <TabItem>
                        <ChildContent>
                            <TabHeader Text="General"></TabHeader>
                        </ChildContent>
                        <ContentTemplate>
                            <MudContainer>
                                <MudGrid>
                                    <MudItem xs="6">
                                        <SfTextBox @bind-Value="MaterialModel.Title" Placeholder="Titlu" FloatLabelType="FloatLabelType.Auto"></SfTextBox>
                                        <ValidationMessage For="@(() => MaterialModel.Title)" />
                                    </MudItem>
                                    <MudItem xs="6">
                                        <SfTextBox @bind-Value="MaterialModel.Description" Placeholder="Descriere" FloatLabelType="FloatLabelType.Auto"></SfTextBox>
                                        <ValidationMessage For="@(() => MaterialModel.Description)" />
                                    </MudItem>
                                    <MudItem xs="12">
                                        <SfTextBox Readonly="true" @bind-Value="MaterialModel.Url" Placeholder="Url" FloatLabelType="FloatLabelType.Auto"></SfTextBox>
                                        <ValidationMessage For="@(() => MaterialModel.Url)" />
                                    </MudItem>
                                    <MudItem xs="6">
                                        <SfDropDownList AllowFiltering="true" TValue="int?" TItem="MaterialCategoryItem" Placeholder="Categorie" FloatLabelType="FloatLabelType.Auto" DataSource="MaterialCategoryItems" @bind-Value="MaterialModel.MaterialCategoryId">
                                            <DropDownListFieldSettings Text="Name" Value="Id"></DropDownListFieldSettings>
                                        </SfDropDownList>
                                        <ValidationMessage For="@(() => MaterialModel.MaterialCategoryId)" />
                                    </MudItem>
                                    @*  <MudItem xs="6">
                                    <SfTextBox @bind-Value="MaterialModel.Type" Placeholder="Denumire" FloatLabelType="FloatLabelType.Auto"></SfTextBox>
                                    </MudItem> *@
                                </MudGrid>
                            </MudContainer>
                        </ContentTemplate>
                    </TabItem>
                    <TabItem>
                        <ChildContent>
                            <TabHeader Text="Meterial video"></TabHeader>
                        </ChildContent>
                        <ContentTemplate>
                            <MudContainer>
                                <MudGrid>
                                    <MudItem xs="12" Class="d-flex justify-center">
                                        <VideoViewer @ref="VideoViewerReference" 
                                            AlterVideo="false" Id="uploadedMaterial" 
                                            VideoUri="@MaterialModel.Url"
                                            AutoPlay="false"
                                        ></VideoViewer>
                                    </MudItem>
                                    <MudItem xs="12">
                                        <BpFileUpload @ref="BpFileUploadReference" ButtonId="avatarInput"
                                                      UploadFileButtonIcon="@Icons.Material.Filled.CloudUpload"
                                                      UploadFileButtonName="@Resource.Upload_File"
                                                      ShowRenameFileDialog="true"
                                                      AllowedExtensions=".mp4,.mov"
                                                      OnFileSelected="MaterialSelected"
                                                      OnFileUnSelected="MaterialUnSelected"
                                                      OnImageSrcChanged="MaterialChanged"/>
                                        <ValidationMessage For="@(() => MaterialModel.Url)" />
                                    </MudItem>
                                </MudGrid>
                            </MudContainer>
                        </ContentTemplate>
                    </TabItem>
                </TabItems>
            </SfTab>
        </CardContent>
        <CardFooter>
            @* <MudButton ButtonType="MudBlazor.ButtonType.Submit"
            Variant="Variant.Filled"
            Color="Color.Primary"
            Class="ml-auto"
            FullWidth="true">
            <MudText>Salvare</MudText> *@
            <div style="width:100%">
                <SfButton IsPrimary="true" Content="Salvare" CssClass="w-100"></SfButton>
            </div>
        </CardFooter>
    </SfCard>
</EditForm>

